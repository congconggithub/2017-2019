{// 加载头部公共文件 }
<include file="Public:header" />

<link rel="stylesheet" href="__PUBLIC__/admin/css/index.css">
<style>
    body,html{background-color: #f3f3f3;}
    #main{position: relative;top: 20px;}
    /*.content.col-sm-9.col-md-10.col-lg-10 {padding-top: 0;}*/
    @media (min-width: 1200px){
        .content.col-lg-10 {
            width: 88%;
        }
    }
</style>
<script type="text/javascript" src="https://gcsoss.oss-cn-shanghai.aliyuncs.com/common/js/echarts.simple.min.js"></script>
<div class="content col-sm-9 col-md-10 col-lg-10">
    <div class="home-wrap">
        <div class="home-wrap-chart">
            <ul class="home-echart-top">
                <div class="home-echart-box">
                    <li>
                        <span id="top_totalIncomeToday" class="topNum">{$top.totalIncomeToday}0</span>
                        <span>今日入账金额</span>
                    </li>
                    <li>
                        <span id="top_totalSaleToday"  class="topNum">{$top.totalSaleToday}0</span>
                        <span>今日销售额</span>
                    </li>
                    <li>
                        <span id="new7y"  class="topNum">0</span>
                        <span>今日提现</span>
                    </li>
                    <li>
                        <span id="new8"  class="topNum">{$top.totalRegularMoney}0</span>
                        <span>今日资金净流入</span>
                    </li>
                    <li>
                        <span id="new9"  class="topNum">{$top.totalRegularMoney}0</span>
                        <span>当月交易额</span>
                    </li>
                    <li>
                        <span id="diffRegularMoney"  class="topNum">{$top.totalRegularMoney}0</span>
                        <span>存量变化(对比昨日)</span>
                    </li>
                    <li>
                        <span id="top_totalSale"  class="topNum">{$top.totalSale}0</span>
                        <span>累计销售额</span>
                    </li>
                    <li>
                        <span id="top_regularMoney"  class="topNum">{$top.regularMoney}0</span>
                        <span>定期存量</span>
                    </li>
                    <li>
                        <span id="top_regularAccountMoney"  class="topNum">{$top.regularAccountMoney}0</span>
                        <span>账户存量</span>
                    </li>
                    <li>
                        <span id="top_totalRegularMoney"  class="topNum">{$top.totalRegularMoney}0</span>
                        <span>总存量</span>
                    </li>
                </div>


            </ul>

            <div >
                <div class="home-chart home-chart-border home-chart-float ph-main fl ">
                    <div class="home-chart-title chart-border">
                        <div class="home-title-top">
                            <div class="home-title-left">销售/还款统计</div>
                            <div class="home-filter">
                                <div>
                                    <ul class="home-filter-time">
                                        <li class="on" name="first" id="first">7天</li>
                                        <li class="" name="second" id="second">30天</li>
                                        <li class="" name="third" id="third">本月</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="mainBG" style="width: 73%;height: 604px; background-color: #ffffff;position: absolute;top: 60px;left: 0;">
                            <div id="main" style="width: 100%;height:100%; position: absolute; top: 0; background-color: #ffffff;" class="home-charts"></div>
                        </div>

                        <div class="home-shape-box ">
                            <div class="home-shape-top">
                                <div class=" home-shape-right home-shape-right1">
                                    <div class="home-right-row">
                                        <div>今日销售额<p title="{$sale.todaySale}" class="num-now" id="todaySale">{$sale.todaySale|number_format=2}</p></div>
                                        <div>比昨日<p class="num-positive" title="{$sale.comYes}" id="sale_comYes">{$sale.comYes|number_format=2}</p></div>
                                    </div>
                                    <div class="home-right-row">
                                        <div>本周销售额<p title="{$sale.weekSale}" class="num-now"  id="sale_weekSale">{$sale.weekSale|number_format=2}</p></div>
                                        <div>比上周同期<p class="num-positive" title="{$sale.comWeek}" id="sale_comWeek">{$sale.comWeek|number_format=2}</p></div>
                                    </div>
                                    <div class="home-right-row">
                                        <div>本月销售额<p title="{$sale.thisMonthSale}"  class="num-now"  id="sale_thisMonthSale">{$sale.thisMonthSale|number_format=2}</p></div>
                                        <div>比上月同期<p class="num-positive" title="{$sale.comMonth}" id="sale_comMonth">{$sale.comMonth|number_format=2}</p></div>
                                    </div>
                                </div>
                                <div class="home-shape-right home-shape-right2">
                                    <div class="home-right-row">
                                        <div>今日已还款<p title="{$repay.todayRepay}" id="todayRepay"  class="num-now">{$repay.todayRepay|number_format=2}</p></div>
                                        <div>比昨日<p class="num-positive" title="{$repay.comYes}" id="comYes">{$repay.comYes|number_format=2}</p></div>
                                    </div>
                                    <div class="home-right-row">
                                        <div>本周已还款<p title="{$repay.weekRepay}" id="weekRepay"  class="num-now">{$repay.weekRepay|number_format=2}</p></div>
                                        <div>比上周同期<p class="num-positive" title="{$repay.comWeek}" id="comWeek">{$repay.comWeek|number_format=2}</p></div>
                                    </div>
                                    <div class="home-right-row">
                                        <div>本月已还款<p title="{$repay.thisMonthRepay}" id="thisMonthRepay" class="num-now">{$repay.thisMonthRepay|number_format=2}</p></div>
                                        <div>比上月同期<p class="num-positive" title="{$repay.comMonth}" id="comMonth">{$repay.comMonth|number_format=2}</p></div>
                                    </div>
                                </div>
                            </div>
                            <div class="home-shape-bottom">
                                <div class="bom-text">来自银行卡的投资金额<p id="fromBank" class="bom-num"></p></div>
                                <div class="bom-text">来自账户的投资金额<p id="fromAccount"  class="bom-num"></p></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="home-chart home-chart-border home-chart-float ph-main fl home-chart-fr">
                    <div class="home-chart-title chart-border">
                        <div class="home-title-top">
                            <div class="home-title-left">入账/提现统计</div>
                            <div class="home-filter">
                                <div>
                                    <ul class="home-filter-time">
                                        <li class="on" name="first" id="booked-first">7天</li>
                                        <li class="" name="second" id="booked-second">30天</li>
                                        <li class="" name="third" id="booked-third">本月</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="mainBG" style="width: 73%; min-width:593px;height: 604px; background-color: #ffffff;position: absolute;top: 60px;left: 0;">
                            <div id="main-booked" style="width: 100%;height:100%; position: absolute; top: 0; background-color: #ffffff;" class="home-charts"></div>
                        </div>
                        <div class="home-shape-box ">
                            <div class="home-shape-top">
                                <div class=" home-shape-right home-shape-right1">
                                    <div class="home-right-row">
                                        <div>今日入账<p id="incomeTotalIncomeToday"  class="num-now"></p></div>
                                        <div>比昨日<p class="num-positive" id="incomeComYes"></p></div>
                                    </div>
                                    <div class="home-right-row">
                                        <div>本周入账<p id="incomeTotalIncomeWeek"  class="num-now"></p></div>
                                        <div>比上周同期<p class="num-positive" id="incomeComWeek"></p></div>
                                    </div>
                                    <div class="home-right-row">
                                        <div>本月入账<p id="incomeTotalIncomeMonth"  class="num-now"></p></div>
                                        <div>比上月同期<p class="num-positive" id="incomeComMonth"></p></div>
                                    </div>
                                </div>
                                <div class="home-shape-right home-shape-right2">
                                    <div class="home-right-row">
                                        <div>今日提现额<p title="{$withdraw.todayWithdraw}" id="withdraw_todayWithdraw"  class="num-now">{$withdraw.todayWithdraw|number_format=2}</p></div>
                                        <div>比昨日<p class="num-positive" title="{$withdraw.comYes}" id="withdraw_comYes">{$withdraw.comYes|number_format=2}</p></div>
                                    </div>
                                    <div class="home-right-row">
                                        <div>本周提现额<p title="{$withdraw.weekWithdraw}" id="withdraw_weekWithdraw" class="num-now">{$withdraw.weekWithdraw|number_format=2}</p></div>
                                        <div>比上周同期<p class="num-positive" title="{$withdraw.comWeek}" id="withdraw_comWeek">{$withdraw.comWeek|number_format=2}</p></div>
                                    </div>
                                    <div class="home-right-row">
                                        <div>本月提现额<p title="{$withdraw.thisMonthWithdraw}" id="withdraw_thisMonthWithdraw" class="num-now">{$withdraw.thisMonthWithdraw|number_format=2}</p></div>
                                        <div>比上月同期<p class="num-positive" title="{$withdraw.comMonth}" id="withdraw_comMonth">{$withdraw.comMonth|number_format=2}</p></div>
                                    </div>
                                </div>
                            </div>

                            <div class="home-shape-bottom">
                                <div class="bom-text">从银行卡充值到账户金额<p id="toAccount"  class="bom-num"></p></div>
                                <div class="bom-text">从银行卡直接购买产品金额<p id="toProduct" class="bom-num"></p></div>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>

</div>
<script>

    $(function(){
        $(document).on('click','.home-filter-time li', function(){
            $(this).addClass('on').siblings('li').removeClass('on');
        })
        getStatic();

        //销售、还款
        sales();
        booked();
        /**/
//        backed();
//        drawal();
    });

    //销售 还款 图标
    function sales (){
        var myChart1 = echarts.init(document.getElementById('main'));
        option = {
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross',
                    label:{
                        backgroundColor:'#3c84f0'
                    }
                }
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: []
            },
            yAxis: {
                type: 'value'
            },
            series: [{
                name: '还款',
                data: [],
                type: 'line',
                showAllSymbol: true,
                itemStyle:{
                    normal:{
                        color:"#3C84F0",
                        lineStyle:{
                            color:"#3C84F0"
                        }
                    }
                }
            },
                {
                    name: '销量',
                    data: [],
                    type: 'line',
                    showAllSymbol: true
                }
            ]
        };
        myChart1.setOption(option,true);
        function data(msg){
            $.ajax({
                url: ROOT + '/public/sale_data',
                type: 'post',
                data: {day:msg,isNew:1},
                success:function(res){
                    if (res.state == 30001){
                        myChart1.setOption({
                            xAxis: {
                                data: res.data.sale.timelist
                            },
                            series: [{
                                name:'还款',
                                data:res.data.repay.datalist
                                }, {
                                name: '销量',
                                data: res.data.sale.datalist
                                }
                            ]
                        });
                        var fromBank = decimal(res.data.sale.fromBank, 2);
                        var fromAccount = decimal(res.data.sale.fromAccount, 2);
                        $('#fromBank').html(fromBank);
                        $('#fromAccount').html(fromAccount);
                    }else{
                        alert(res.msg);
                    }
                }
            });

        };

        data(7);
        $(document).on('click','#first', function(){
            data(7);
        });
        $(document).on('click','#second', function(){
            data(30);
        });
        $(document).on('click','#third', function(){
            data(1);
        });
    }

    //入账和提现统计
    function booked(){
        var myChart2 = echarts.init(document.getElementById('main-booked'));
        option1 = {
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross'
                }
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: []
            },
            yAxis: {
                type: 'value'
            },
            series: [{
                name: '入账',
                data: [],
                type: 'line',
                showAllSymbol: true
            },
            {
                name: '提现',
                data: [],
                type: 'line',
                showAllSymbol: true
            }]
        };
        myChart2.setOption(option1,true);
        function bookedMsg(msg){
            $.ajax({
                url: ROOT + '/public/income_data',
                type: 'post',
                data: {day:msg,isNew:1},
                success:function(res){
                    if (res.state == 30001){
                        myChart2.setOption({
                            xAxis: {
                                data: res.data.withdraw.timelist
                            },
                            series: [{
                                name: '入账',
                                data: res.data.income.datalist
                            },
                            {
                                name: '提现',
                                data: res.data.withdraw.datalist
                            }
                            ]
                        });
                        var toAccount = decimal(res.data.income.toAccount, 2);
                        var toProduct = decimal(res.data.income.toProduct, 2);
                        var useRed=  decimal(res.data.income.useRed, 2);
                        $('#toAccount').html(toAccount);
                        $('#toProduct').html(toProduct+"(红包抵扣:"+useRed+")");
                    }else{
                        alert(res.msg);
                    }
                }
            });
        }
        bookedMsg(7);
        $(document).on('click','#booked-first', function(){
            bookedMsg(7);
        });
        $(document).on('click','#booked-second', function(){
            bookedMsg(30);
        });
        $(document).on('click','#booked-third', function(){
            bookedMsg(1);
        });
    }

    function decimal(s, n){
        // s:传入的float数字 ，n:希望返回小数点几位
        n = n > 0 && n <= 20 ? n : 2;
        s = parseFloat((s + "").replace(/[^\d\.-]/g, "")).toFixed(n) + ""
        var l = s.split(".")[0].split("").reverse(), r = s.split(".")[1]
        var t = ""
        for (var i = 0; i < l.length; i++) {
            t += l[i] + ((i + 1) % 3 == 0 && (i + 1) != l.length ? "," : "")
        }
        return t.split("").reverse().join("") + "." + r
    }

    getDataByChart();
    //入账数据
    function getDataByChart() {
        $.ajax({
            url : "{:U('Public/ajaxIndexDataStatistics')}",
            type: 'post',
            data:{isNew:1},
            success : function (result) {
                $('#incomeTotalIncomeToday').html(result.income.totalIncomeToday);
                $('#incomeComYes').html(result.income.comYes);
                $('#incomeTotalIncomeWeek').html(result.income.totalIncomeWeek);
                $('#incomeComWeek').html(result.income.comWeek);
                $('#incomeTotalIncomeMonth').html(result.income.totalIncomeMonth);
                $('#incomeComMonth').html(result.income.comMonth);
            }
        });
    }

    /*
         * 参数说明：
         * number：要格式化的数字
         * decimals：保留几位小数
         * dec_point：小数点符号
         * thousands_sep：千分位符号
         * */
    function number_format(number, decimals, dec_point, thousands_sep) {
        number = (number + '').replace(/[^0-9+-Ee.]/g, '');
        var n = !isFinite(+number) ? 0 : +number,
            prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),
            sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,
            dec = (typeof dec_point === 'undefined') ? '.' : dec_point,
            s = '',
            toFixedFix = function (n, prec) {
                var k = Math.pow(10, prec);
                return '' + Math.ceil(n * k) / k;
            };

        s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.');
        var re = /(-?\d+)(\d{3})/;
        while (re.test(s[0])) {
            s[0] = s[0].replace(re, "$1" + sep + "$2");
        }

        if ((s[1] || '').length < prec) {
            s[1] = s[1] || '';
            s[1] += new Array(prec - s[1].length + 1).join('0');
        }
        return s.join(dec);
    }
    function number2_format(num){
        return number_format(num,2);
    }
    function getStatic(){
        $.ajax({
            url: ROOT + '/public/getStatic',
            type: 'post',
            success:function(res){
                if(res.state==30001){
                    var dat=res.data;
                    if(dat.repay){
                        var repay=dat.repay;
                        $("#todayRepay").html(number2_format(repay.todayRepay));
                        $("#comYes").html(number2_format(repay.comYes));
                        $("#comWeek").html(number2_format(repay.comWeek));
                        $("#comMonth").html(number2_format(repay.comMonth));
                        $("#thisMonthRepay").html(number2_format(repay.thisMonthRepay));
                        $("#weekRepay").html(number2_format(repay.weekRepay));
                    }
                    if(dat.sale){
                        var sale=dat.sale;
                        $("#sale_comMonth").html(number2_format(sale.comMonth));
                        $("#sale_comWeek").html(number2_format(sale.comWeek));
                        $("#sale_comYes").html(number2_format(sale.comYes));
                        $("#sale_thisMonthSale").html(number2_format(sale.thisMonthSale));
                        $("#todaySale").html(number2_format(sale.todaySale));
                        $("#sale_weekSale").html(number2_format(sale.weekSale));
                        $("#new9").html((sale.thisMonthSaleFormat));
                    }
                    if(dat.top){
                        var top= dat.top;
                        $("#top_totalSaleToday").html(top.totalSaleToday);
                        $("#top_totalSale").html(top.totalSale);
                        $("#top_regularMoney").html(top.regularMoney);
                        $("#top_regularAccountMoney").html(top.regularAccountMoney);
                        $("#top_totalRegularMoney").html(top.totalRegularMoney);
                        $("#top_totalIncomeToday").html(top.totalIncomeToday);
                        $("#diffRegularMoney").html(top.diffRegularMoney);
                        $("#new8").html(top.netInflow);
                    }
                    if(dat.withdraw){
                        var withdraw= dat.withdraw;
                        $("#withdraw_comMonth").html(number2_format(withdraw.comMonth));
                        $("#withdraw_comWeek").html(number2_format(withdraw.comWeek));
                        $("#withdraw_comYes").html(number2_format(withdraw.comYes));
                        $("#withdraw_thisMonthWithdraw").html(number2_format(withdraw.thisMonthWithdraw));
                        $("#withdraw_todayWithdraw").html(number2_format(withdraw.todayWithdraw));
                        $("#new7y").html(withdraw.todayWithdrawFormat?withdraw.todayWithdrawFormat:0);
                        $("#withdraw_weekWithdraw").html(number2_format(withdraw.weekWithdraw));
                    }
                }
            }
        });
    }

</script>
<!-- 主页面结束 -->
{// 加载尾部公共文件 }
<include file="Public:footer" />